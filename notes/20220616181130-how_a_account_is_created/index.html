<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>How is an Account Created | Taking Smart Notes With Org-mode</title>
<meta name="keywords" content="">
<meta name="description" content="
tags: Starcoin Web3 StarTrek,Account-Model Blockchain Systems

We can create an account by wallet like MetaMask or StarMask, but I&rsquo;m curious about how an account is created on the blockchain system.
As a wallet has been embedded in the starcoin node, we can use it to create an account as follow:
$ ./target/debug/starcoin -d ~/.starcoin -n dev account create -p my-pass
{
  &#34;ok&#34;: {
    &#34;address&#34;: &#34;0x2f1aeb63bd30d8eb841d6a941c5d6df3&#34;,
    &#34;is_default&#34;: false,
    &#34;is_readonly&#34;: false,
    &#34;public_key&#34;: &#34;0x91f79bdd9ced49332bf85b751d02339e05aff047c386d0c14b380d8519d2fb4b&#34;,
    &#34;receipt_identifier&#34;: &#34;stc1p9udwkcaaxrvwhpqad22pchtd7vy2276p&#34;
  }
}
As above we can see our account has been created, and the address is: 0x2f1aeb63bd30d8eb841d6a941c5d6df3. We&rsquo;ll find some files are created, if we check our local directory at ~/.starcoin/dev:">
<meta name="author" content="Gray King">
<link rel="canonical" href="https://notes.0081800.xyz/notes/20220616181130-how_a_account_is_created/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.2211ca3164be7830024f6aad2b3a2e520843a64f8f048445c3401c1249aa051d.css" integrity="sha256-IhHKMWS&#43;eDACT2qtKzouUghDpk&#43;PBIRFw0AcEkmqBR0=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://notes.0081800.xyz/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://notes.0081800.xyz/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://notes.0081800.xyz/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://notes.0081800.xyz/apple-touch-icon.png">
<link rel="mask-icon" href="https://notes.0081800.xyz/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://notes.0081800.xyz/notes/20220616181130-how_a_account_is_created/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://notes.0081800.xyz/notes/20220616181130-how_a_account_is_created/">
  <meta property="og:site_name" content="Taking Smart Notes With Org-mode">
  <meta property="og:title" content="How is an Account Created">
  <meta property="og:description" content=" tags: Starcoin Web3 StarTrek,Account-Model Blockchain Systems We can create an account by wallet like MetaMask or StarMask, but I’m curious about how an account is created on the blockchain system.
As a wallet has been embedded in the starcoin node, we can use it to create an account as follow:
$ ./target/debug/starcoin -d ~/.starcoin -n dev account create -p my-pass { &#34;ok&#34;: { &#34;address&#34;: &#34;0x2f1aeb63bd30d8eb841d6a941c5d6df3&#34;, &#34;is_default&#34;: false, &#34;is_readonly&#34;: false, &#34;public_key&#34;: &#34;0x91f79bdd9ced49332bf85b751d02339e05aff047c386d0c14b380d8519d2fb4b&#34;, &#34;receipt_identifier&#34;: &#34;stc1p9udwkcaaxrvwhpqad22pchtd7vy2276p&#34; } } As above we can see our account has been created, and the address is: 0x2f1aeb63bd30d8eb841d6a941c5d6df3. We’ll find some files are created, if we check our local directory at ~/.starcoin/dev:">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="notes">
    <meta property="article:published_time" content="2022-06-16T18:11:00+08:00">
    <meta property="article:modified_time" content="2022-06-16T18:11:00+08:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="How is an Account Created">
<meta name="twitter:description" content="
tags: Starcoin Web3 StarTrek,Account-Model Blockchain Systems

We can create an account by wallet like MetaMask or StarMask, but I&rsquo;m curious about how an account is created on the blockchain system.
As a wallet has been embedded in the starcoin node, we can use it to create an account as follow:
$ ./target/debug/starcoin -d ~/.starcoin -n dev account create -p my-pass
{
  &#34;ok&#34;: {
    &#34;address&#34;: &#34;0x2f1aeb63bd30d8eb841d6a941c5d6df3&#34;,
    &#34;is_default&#34;: false,
    &#34;is_readonly&#34;: false,
    &#34;public_key&#34;: &#34;0x91f79bdd9ced49332bf85b751d02339e05aff047c386d0c14b380d8519d2fb4b&#34;,
    &#34;receipt_identifier&#34;: &#34;stc1p9udwkcaaxrvwhpqad22pchtd7vy2276p&#34;
  }
}
As above we can see our account has been created, and the address is: 0x2f1aeb63bd30d8eb841d6a941c5d6df3. We&rsquo;ll find some files are created, if we check our local directory at ~/.starcoin/dev:">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Notes",
      "item": "https://notes.0081800.xyz/notes/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "How is an Account Created",
      "item": "https://notes.0081800.xyz/notes/20220616181130-how_a_account_is_created/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "How is an Account Created",
  "name": "How is an Account Created",
  "description": " tags: Starcoin Web3 StarTrek,Account-Model Blockchain Systems We can create an account by wallet like MetaMask or StarMask, but I\u0026rsquo;m curious about how an account is created on the blockchain system.\nAs a wallet has been embedded in the starcoin node, we can use it to create an account as follow:\n$ ./target/debug/starcoin -d ~/.starcoin -n dev account create -p my-pass { \u0026#34;ok\u0026#34;: { \u0026#34;address\u0026#34;: \u0026#34;0x2f1aeb63bd30d8eb841d6a941c5d6df3\u0026#34;, \u0026#34;is_default\u0026#34;: false, \u0026#34;is_readonly\u0026#34;: false, \u0026#34;public_key\u0026#34;: \u0026#34;0x91f79bdd9ced49332bf85b751d02339e05aff047c386d0c14b380d8519d2fb4b\u0026#34;, \u0026#34;receipt_identifier\u0026#34;: \u0026#34;stc1p9udwkcaaxrvwhpqad22pchtd7vy2276p\u0026#34; } } As above we can see our account has been created, and the address is: 0x2f1aeb63bd30d8eb841d6a941c5d6df3. We\u0026rsquo;ll find some files are created, if we check our local directory at ~/.starcoin/dev:\n",
  "keywords": [
    
  ],
  "articleBody": " tags: Starcoin Web3 StarTrek,Account-Model Blockchain Systems We can create an account by wallet like MetaMask or StarMask, but I’m curious about how an account is created on the blockchain system.\nAs a wallet has been embedded in the starcoin node, we can use it to create an account as follow:\n$ ./target/debug/starcoin -d ~/.starcoin -n dev account create -p my-pass { \"ok\": { \"address\": \"0x2f1aeb63bd30d8eb841d6a941c5d6df3\", \"is_default\": false, \"is_readonly\": false, \"public_key\": \"0x91f79bdd9ced49332bf85b751d02339e05aff047c386d0c14b380d8519d2fb4b\", \"receipt_identifier\": \"stc1p9udwkcaaxrvwhpqad22pchtd7vy2276p\" } } As above we can see our account has been created, and the address is: 0x2f1aeb63bd30d8eb841d6a941c5d6df3. We’ll find some files are created, if we check our local directory at ~/.starcoin/dev:\n$ ls -l ~/.starcoin/dev drwxr-xr-x 10 wh staff 320 Jun 16 18:32 account_vaults -rw-r--r-- 1 wh staff 257 Jun 16 18:32 config.toml -rw-r--r-- 1 wh staff 89048 Jun 16 18:32 genesis -rw-r--r-- 1 wh staff 10710 Jun 16 18:32 genesis_config.json -rw------- 1 wh staff 64 Jun 16 18:32 network_key srw------- 1 wh staff 0 Jun 16 18:32 starcoin.ipc -rw-r--r-- 1 wh staff 14678 Jun 16 18:32 starcoin.log drwxr-xr-x 3 wh staff 96 Jun 16 18:32 starcoindb We’ll meet them later, for now, let’s follow the source code to find how an account is created.\nTwo Account Provider Strategies From the code here we can see:\nIf there is a account_dir configured, then it should be AccountProviderStrategy::Local Otherwise AccountProviderStrategy::RPC is used. As we specify the -d ~/.starcoin to run above command to create an account, so I think the account_dir could be ~/.starcoin/dev/account_vaults. Just simply add a print statement in account/provider/src/provider/mod.rs, and remove the directory, then build \u0026 run it again:\n$ rm -rf ~/.starcoin/dev/ $ cargo build $ ./target/debug/starcoin -d ~/.starcoin -n dev account create -p my-pass +++++++ RPC { \"ok\": { \"address\": \"0x7760d5c787b9918005d82cca6d8225a9\", \"is_default\": false, \"is_readonly\": false, \"public_key\": \"0xa8459efd0f6becd563bca5ea6d8b930e9f6f19a30aef1b9632baa62f59e2a21d\", \"receipt_identifier\": \"stc1pwasdt3u8hxgcqpwc9n9xmq394y0qwh24\" } } Emmm, things don’t always happen as your thoughts, aren’t they? AccountProviderStrategy only will be used if we run command and pass --local-account-dir option:\n$ ./target/debug/starcoin -d ~/.starcoin/ --local-account-dir=~/.starcoin/dev/account_vaults/ -n dev account create -p my-pass +++++++ LOCAL { \"ok\": { \"address\": \"0x18d44098682869343f232d6cf0bdf9a9\", \"is_default\": true, \"is_readonly\": false, \"public_key\": \"0x17e9deb0b3784b5abebad3a7cb8030c23360d6b7f8d108a8186d20e2a23b51ff\", \"receipt_identifier\": \"stc1prr2ypxrg9p5ng0er94k0p00e4yhnhgw0\" } } There it is.\nAccountManager \u0026 AccountStorage I’m tracing the invocation path, and find that no matter which strategy is used, then eventually, the AccountManager is used to do the actually job. And it mainly relys on AccountStorage.\nNow let’s check the defination of AccountManager.create_account:\npub fn create_account(\u0026self, password: \u0026str) -\u003e AccountResult\u003cAccount\u003e { let private_key = gen_private_key(); let private_key = AccountPrivateKey::Single(private_key); let address = private_key.public_key().derived_address(); self.save_account( address, private_key.public_key(), Some((private_key, password.to_string())), ) } It’s very simple, just generate a private key, and use it’s public key to derive an address, that’s how your account address comes out.\nTwo more invocations are involved: generate_private_key and AccountManager.save_account. Let’s check the first one:\ngenerate_private_key pub(crate) fn gen_private_key() -\u003e Ed25519PrivateKey { let mut seed_rng = rand::rngs::OsRng; let seed_buf: [u8; 32] = seed_rng.gen(); let mut rng: StdRng = SeedableRng::from_seed(seed_buf); Ed25519PrivateKey::generate(\u0026mut rng) } Emmm, we are using Ed25519, as konwn as EdDSA(Edwards-curve Digital Signature Algorithm).\nThen how an address is derived? As we can see, the address is derived by a public key, which defined in starcoin_vm_types::transaction::authenticator::AccountPublicKey.derived_address. The main function of this invocation is use starcoin_vm_types::transaction::authenticator::AuthenticationKey::from_preimage create and AuthenticationKey can call derived_address that bind to it:\n/// Create an authentication key from a preimage by taking its sha3 hash pub fn from_preimage(preimage: \u0026AuthenticationKeyPreimage) -\u003e AuthenticationKey { AuthenticationKey::new(*HashValue::sha3_256_of(\u0026preimage.0).as_ref()) } /// Return an address derived from the last `AccountAddress::LENGTH` bytes of this /// authentication key. pub fn derived_address(\u0026self) -\u003e AccountAddress { // keep only last 16 bytes let mut array = [0u8; AccountAddress::LENGTH]; array.copy_from_slice(\u0026self.0[Self::LENGTH - AccountAddress::LENGTH..]); AccountAddress::new(array) } How to avoid collision of address? TODO\nHow is an Account be Saved? It’s mainly implemented in AccountManager.save_account:\nCheck existence. Verify private key and password. Invoke Account::create to create the account: store it to corresponding place, and change the corresponding settings. Add to store. Set it to default, if it’s the first address. Conclusion So, an account has been created. There is no magic happens, which means no on chain operations are involved. Just generates a private key and public key pair, and derives an address.\nThe key pair is just a way that proof you own the address. So on the blockchain, you can send coins to any address, if nobody can proof that his owns that address, then the coins some how is lost forever.\n",
  "wordCount" : "724",
  "inLanguage": "en",
  "datePublished": "2022-06-16T18:11:00+08:00",
  "dateModified": "2022-06-16T18:11:00+08:00",
  "author":[{
    "@type": "Person",
    "name": "Gray King"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://notes.0081800.xyz/notes/20220616181130-how_a_account_is_created/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Taking Smart Notes With Org-mode",
    "logo": {
      "@type": "ImageObject",
      "url": "https://notes.0081800.xyz/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://notes.0081800.xyz/" accesskey="h" title="Taking Smart Notes With Org-mode (Alt + H)">Taking Smart Notes With Org-mode</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://notes.0081800.xyz/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://notes.0081800.xyz/articles/" title="Articles">
                    <span>Articles</span>
                </a>
            </li>
            <li>
                <a href="https://notes.0081800.xyz/notes/" title="Notes">
                    <span>Notes</span>
                </a>
            </li>
            <li>
                <a href="https://notes.0081800.xyz/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://notes.0081800.xyz/">Home</a>&nbsp;»&nbsp;<a href="https://notes.0081800.xyz/notes/">Notes</a></div>
    <h1 class="post-title entry-hint-parent">
      How is an Account Created
    </h1>
    <div class="post-meta"><span title='2022-06-16 18:11:00 +0800 +0800'>June 16, 2022</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Gray King

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#two-account-provider-strategies" aria-label="Two Account Provider Strategies">Two Account Provider Strategies</a></li>
                <li>
                    <a href="#accountmanager-and-accountstorage" aria-label="AccountManager &amp; AccountStorage">AccountManager &amp; AccountStorage</a><ul>
                        
                <li>
                    <a href="#generate-private-key" aria-label="generate_private_key">generate_private_key</a><ul>
                        
                <li>
                    <a href="#then-how-an-address-is-derived" aria-label="Then how an address is derived?">Then how an address is derived?</a></li>
                <li>
                    <a href="#how-to-avoid-collision-of-address" aria-label="How to avoid collision of address?">How to avoid collision of address?</a></li></ul>
                </li>
                <li>
                    <a href="#how-is-an-account-be-saved" aria-label="How is an Account be Saved?">How is an Account be Saved?</a></li></ul>
                </li>
                <li>
                    <a href="#conclusion" aria-label="Conclusion">Conclusion</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><ul>
<li>tags: <a href="/notes/20220531104515-starcoin_web3_startrek/">Starcoin Web3 StarTrek</a>,<a href="/notes/20220607185130-account_model_blockchain_systems/">Account-Model Blockchain Systems</a></li>
</ul>
<p>We can create an account by wallet like MetaMask or StarMask, but I&rsquo;m curious about how an account is created on the blockchain system.</p>
<p>As a wallet has been embedded in the starcoin node, we can use it to create an account as follow:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./target/debug/starcoin -d ~/.starcoin -n dev account create -p my-pass
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;ok&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;address&#34;</span>: <span style="color:#e6db74">&#34;0x2f1aeb63bd30d8eb841d6a941c5d6df3&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;is_default&#34;</span>: false,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;is_readonly&#34;</span>: false,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;public_key&#34;</span>: <span style="color:#e6db74">&#34;0x91f79bdd9ced49332bf85b751d02339e05aff047c386d0c14b380d8519d2fb4b&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;receipt_identifier&#34;</span>: <span style="color:#e6db74">&#34;stc1p9udwkcaaxrvwhpqad22pchtd7vy2276p&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>As above we can see our account has been created, and the address is: <code>0x2f1aeb63bd30d8eb841d6a941c5d6df3</code>. We&rsquo;ll find some files are created, if we check our local directory at <code>~/.starcoin/dev</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ls -l ~/.starcoin/dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">10</span> wh  staff    <span style="color:#ae81ff">320</span> Jun <span style="color:#ae81ff">16</span> 18:32 account_vaults
</span></span><span style="display:flex;"><span>-rw-r--r--   <span style="color:#ae81ff">1</span> wh  staff    <span style="color:#ae81ff">257</span> Jun <span style="color:#ae81ff">16</span> 18:32 config.toml
</span></span><span style="display:flex;"><span>-rw-r--r--   <span style="color:#ae81ff">1</span> wh  staff  <span style="color:#ae81ff">89048</span> Jun <span style="color:#ae81ff">16</span> 18:32 genesis
</span></span><span style="display:flex;"><span>-rw-r--r--   <span style="color:#ae81ff">1</span> wh  staff  <span style="color:#ae81ff">10710</span> Jun <span style="color:#ae81ff">16</span> 18:32 genesis_config.json
</span></span><span style="display:flex;"><span>-rw-------   <span style="color:#ae81ff">1</span> wh  staff     <span style="color:#ae81ff">64</span> Jun <span style="color:#ae81ff">16</span> 18:32 network_key
</span></span><span style="display:flex;"><span>srw-------   <span style="color:#ae81ff">1</span> wh  staff      <span style="color:#ae81ff">0</span> Jun <span style="color:#ae81ff">16</span> 18:32 starcoin.ipc
</span></span><span style="display:flex;"><span>-rw-r--r--   <span style="color:#ae81ff">1</span> wh  staff  <span style="color:#ae81ff">14678</span> Jun <span style="color:#ae81ff">16</span> 18:32 starcoin.log
</span></span><span style="display:flex;"><span>drwxr-xr-x   <span style="color:#ae81ff">3</span> wh  staff     <span style="color:#ae81ff">96</span> Jun <span style="color:#ae81ff">16</span> 18:32 starcoindb
</span></span></code></pre></div><p>We&rsquo;ll meet them later, for now, let&rsquo;s follow the source code to find how an account is created.</p>
<h2 id="two-account-provider-strategies">Two Account Provider Strategies<a hidden class="anchor" aria-hidden="true" href="#two-account-provider-strategies">#</a></h2>
<p>From the code <a href="https://github.com/starcoinorg/starcoin/blob/eb5897525ebf2ac3c135154ed9455b144747ae0e/config/src/account_provider_config.rs#L34-L42">here</a> we can see:</p>
<ul>
<li>If there is a <code>account_dir</code> configured, then it should be <code>AccountProviderStrategy::Local</code></li>
<li>Otherwise <code>AccountProviderStrategy::RPC</code> is used.</li>
</ul>
<p>As we specify the <code>-d ~/.starcoin</code> to run above command to create an account, so I think the <code>account_dir</code> could be <code>~/.starcoin/dev/account_vaults</code>.
Just simply add a print statement in <a href="https://github.com/starcoinorg/starcoin/blob/eb5897525ebf2ac3c135154ed9455b144747ae0e/account/provider/src/provider/mod.rs#L13">account/provider/src/provider/mod.rs</a>, and remove the directory, then build &amp; run it again:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>  $ rm -rf ~/.starcoin/dev/
</span></span><span style="display:flex;"><span>  $ cargo build
</span></span><span style="display:flex;"><span>  $ ./target/debug/starcoin -d ~/.starcoin -n dev account create -p my-pass
</span></span><span style="display:flex;"><span> +++++++  RPC
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;ok&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;address&#34;</span>: <span style="color:#e6db74">&#34;0x7760d5c787b9918005d82cca6d8225a9&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;is_default&#34;</span>: false,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;is_readonly&#34;</span>: false,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;public_key&#34;</span>: <span style="color:#e6db74">&#34;0xa8459efd0f6becd563bca5ea6d8b930e9f6f19a30aef1b9632baa62f59e2a21d&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;receipt_identifier&#34;</span>: <span style="color:#e6db74">&#34;stc1pwasdt3u8hxgcqpwc9n9xmq394y0qwh24&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Emmm, things don&rsquo;t always happen as your thoughts, aren&rsquo;t they? <code>AccountProviderStrategy</code> only will be used if we run command and pass <code>--local-account-dir</code> option:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>  $ ./target/debug/starcoin -d ~/.starcoin/ --local-account-dir<span style="color:#f92672">=</span>~/.starcoin/dev/account_vaults/ -n dev account create -p my-pass
</span></span><span style="display:flex;"><span>  +++++++  LOCAL
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;ok&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;address&#34;</span>: <span style="color:#e6db74">&#34;0x18d44098682869343f232d6cf0bdf9a9&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;is_default&#34;</span>: true,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;is_readonly&#34;</span>: false,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;public_key&#34;</span>: <span style="color:#e6db74">&#34;0x17e9deb0b3784b5abebad3a7cb8030c23360d6b7f8d108a8186d20e2a23b51ff&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;receipt_identifier&#34;</span>: <span style="color:#e6db74">&#34;stc1prr2ypxrg9p5ng0er94k0p00e4yhnhgw0&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>There it is.</p>
<h2 id="accountmanager-and-accountstorage"><code>AccountManager</code> &amp; <code>AccountStorage</code><a hidden class="anchor" aria-hidden="true" href="#accountmanager-and-accountstorage">#</a></h2>
<p>I&rsquo;m tracing the invocation path, and find that no matter which strategy is used, then eventually, the <a href="https://github.com/starcoinorg/starcoin/blob/f0d73fb12f7808e7bd440b5b02a4440e6c0f674c/account/src/account_manager.rs#L28">AccountManager</a> is used to do the actually job.
And it mainly relys on <a href="https://github.com/starcoinorg/starcoin/blob/f0d73fb12f7808e7bd440b5b02a4440e6c0f674c/account/src/account_storage.rs#L183">AccountStorage</a>.</p>
<p>Now let&rsquo;s check the defination of <code>AccountManager.create_account</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">create_account</span>(<span style="color:#f92672">&amp;</span>self, password: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; <span style="color:#a6e22e">AccountResult</span><span style="color:#f92672">&lt;</span>Account<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> private_key <span style="color:#f92672">=</span> gen_private_key();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> private_key <span style="color:#f92672">=</span> AccountPrivateKey::Single(private_key);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> address <span style="color:#f92672">=</span> private_key.public_key().derived_address();
</span></span><span style="display:flex;"><span>    self.save_account(
</span></span><span style="display:flex;"><span>        address,
</span></span><span style="display:flex;"><span>        private_key.public_key(),
</span></span><span style="display:flex;"><span>        Some((private_key, password.to_string())),
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>It&rsquo;s very simple, just generate a private key, and use it&rsquo;s public key to derive an address, that&rsquo;s how your account address comes out.</p>
<p>Two more invocations are involved: <code>generate_private_key</code> and <code>AccountManager.save_account</code>. Let&rsquo;s check the first one:</p>
<h3 id="generate-private-key"><code>generate_private_key</code><a hidden class="anchor" aria-hidden="true" href="#generate-private-key">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">pub</span>(<span style="color:#66d9ef">crate</span>) <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">gen_private_key</span>() -&gt; <span style="color:#a6e22e">Ed25519PrivateKey</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> seed_rng <span style="color:#f92672">=</span> rand::rngs::OsRng;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> seed_buf: [<span style="color:#66d9ef">u8</span>; <span style="color:#ae81ff">32</span>] <span style="color:#f92672">=</span> seed_rng.gen();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> rng: <span style="color:#a6e22e">StdRng</span> <span style="color:#f92672">=</span> SeedableRng::from_seed(seed_buf);
</span></span><span style="display:flex;"><span>    Ed25519PrivateKey::generate(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> rng)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Emmm, we are using <code>Ed25519</code>, as konwn as <a href="https://en.wikipedia.org/wiki/EdDSA">EdDSA(Edwards-curve Digital Signature Algorithm)</a>.</p>
<h4 id="then-how-an-address-is-derived">Then how an address is derived?<a hidden class="anchor" aria-hidden="true" href="#then-how-an-address-is-derived">#</a></h4>
<p>As we can see, the address is derived by a public key, which defined in <a href="https://github.com/starcoinorg/starcoin/blob/f0d73fb12f7808e7bd440b5b02a4440e6c0f674c/vm/types/src/transaction/authenticator.rs#L374-L376">starcoin_vm_types::transaction::authenticator::AccountPublicKey.derived_address</a>.
The main function of this invocation is use  <a href="https://github.com/starcoinorg/starcoin/blob/f0d73fb12f7808e7bd440b5b02a4440e6c0f674c/vm/types/src/transaction/authenticator.rs#L194-L197">starcoin_vm_types::transaction::authenticator::AuthenticationKey::from_preimage</a> create and <code>AuthenticationKey</code> can call
<a href="https://github.com/starcoinorg/starcoin/blob/f0d73fb12f7808e7bd440b5b02a4440e6c0f674c/vm/types/src/transaction/authenticator.rs#L211-L216">derived_address</a> that bind to it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">/// Create an authentication key from a preimage by taking its sha3 hash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">from_preimage</span>(preimage: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">AuthenticationKeyPreimage</span>) -&gt; <span style="color:#a6e22e">AuthenticationKey</span> {
</span></span><span style="display:flex;"><span>    AuthenticationKey::new(<span style="color:#f92672">*</span>HashValue::sha3_256_of(<span style="color:#f92672">&amp;</span>preimage.<span style="color:#ae81ff">0</span>).as_ref())
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">/// Return an address derived from the last `AccountAddress::LENGTH` bytes of this
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/// authentication key.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">derived_address</span>(<span style="color:#f92672">&amp;</span>self) -&gt; <span style="color:#a6e22e">AccountAddress</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// keep only last 16 bytes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> array <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span><span style="color:#66d9ef">u8</span>; AccountAddress::<span style="color:#66d9ef">LENGTH</span>];
</span></span><span style="display:flex;"><span>    array.copy_from_slice(<span style="color:#f92672">&amp;</span>self.<span style="color:#ae81ff">0</span>[Self::<span style="color:#66d9ef">LENGTH</span> <span style="color:#f92672">-</span> AccountAddress::<span style="color:#66d9ef">LENGTH</span><span style="color:#f92672">..</span>]);
</span></span><span style="display:flex;"><span>    AccountAddress::new(array)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="how-to-avoid-collision-of-address">How to avoid collision of address?<a hidden class="anchor" aria-hidden="true" href="#how-to-avoid-collision-of-address">#</a></h4>
<p>TODO</p>
<h3 id="how-is-an-account-be-saved">How is an Account be Saved?<a hidden class="anchor" aria-hidden="true" href="#how-is-an-account-be-saved">#</a></h3>
<p>It&rsquo;s mainly implemented in <a href="https://github.com/starcoinorg/starcoin/blob/f0d73fb12f7808e7bd440b5b02a4440e6c0f674c/account/src/account_manager.rs#L135-L158">AccountManager.save_account</a>:</p>
<ol>
<li>Check existence.</li>
<li>Verify private key and password.</li>
<li>Invoke <a href="https://github.com/starcoinorg/starcoin/blob/f0d73fb12f7808e7bd440b5b02a4440e6c0f674c/account/src/account.rs#L30-L46">Account::create</a> to create the account: store it to corresponding place, and change the corresponding settings.</li>
<li>Add to store.</li>
<li>Set it to default, if it&rsquo;s the first address.</li>
</ol>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>So, an account has been created. There is no magic happens, which means no on chain operations are involved.
Just generates a private key and public key pair, and derives an address.</p>
<p>The key pair is just a way that proof you own the address. So on the blockchain, you can send coins to any address,
if nobody can proof that his owns that address, then the coins some how is lost forever.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>


   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   


<hr />

  <div class="bl-section">
    <h4>No notes link to this note</h4>
  </div>


</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://notes.0081800.xyz/">Taking Smart Notes With Org-mode</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
