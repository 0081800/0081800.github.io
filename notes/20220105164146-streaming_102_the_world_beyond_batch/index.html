<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Streaming 102: The world beyond batch | Taking Smart Notes With Org-mode</title>
<meta name="keywords" content="">
<meta name="description" content="tags: Bigdata,Flink,Dataflow Model,Streaming source: “Streaming 102: The World beyond Batch – O’Reilly.” Accessed January 5, 2022. https://www.oreilly.com/radar/the-world-beyond-batch-streaming-102/. Three more concepts:
Watermarks: Useful for event time windowing. All input data with event times less than watermark have been observed. Triggers: Signal for a window to produce output. Accumulation: The way to handle multiple results that are observed for the same window. Streaming 101 Redux What: Transformations Where: windowing Make a temporal boundary for a unbounded data source.">
<meta name="author" content="Gray King">
<link rel="canonical" href="https://notes.0081800.xyz/notes/20220105164146-streaming_102_the_world_beyond_batch/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css" integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe&#43;FVUFzPh7U=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://notes.0081800.xyz/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://notes.0081800.xyz/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://notes.0081800.xyz/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://notes.0081800.xyz/apple-touch-icon.png">
<link rel="mask-icon" href="https://notes.0081800.xyz/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Streaming 102: The world beyond batch" />
<meta property="og:description" content="tags: Bigdata,Flink,Dataflow Model,Streaming source: “Streaming 102: The World beyond Batch – O’Reilly.” Accessed January 5, 2022. https://www.oreilly.com/radar/the-world-beyond-batch-streaming-102/. Three more concepts:
Watermarks: Useful for event time windowing. All input data with event times less than watermark have been observed. Triggers: Signal for a window to produce output. Accumulation: The way to handle multiple results that are observed for the same window. Streaming 101 Redux What: Transformations Where: windowing Make a temporal boundary for a unbounded data source." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://notes.0081800.xyz/notes/20220105164146-streaming_102_the_world_beyond_batch/" /><meta property="article:section" content="notes" />
<meta property="article:published_time" content="2022-01-05T16:41:00+08:00" />
<meta property="article:modified_time" content="2022-01-05T16:41:00+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Streaming 102: The world beyond batch"/>
<meta name="twitter:description" content="tags: Bigdata,Flink,Dataflow Model,Streaming source: “Streaming 102: The World beyond Batch – O’Reilly.” Accessed January 5, 2022. https://www.oreilly.com/radar/the-world-beyond-batch-streaming-102/. Three more concepts:
Watermarks: Useful for event time windowing. All input data with event times less than watermark have been observed. Triggers: Signal for a window to produce output. Accumulation: The way to handle multiple results that are observed for the same window. Streaming 101 Redux What: Transformations Where: windowing Make a temporal boundary for a unbounded data source."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Notes",
      "item": "https://notes.0081800.xyz/notes/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Streaming 102: The world beyond batch",
      "item": "https://notes.0081800.xyz/notes/20220105164146-streaming_102_the_world_beyond_batch/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Streaming 102: The world beyond batch",
  "name": "Streaming 102: The world beyond batch",
  "description": "tags: Bigdata,Flink,Dataflow Model,Streaming source: “Streaming 102: The World beyond Batch – O’Reilly.” Accessed January 5, 2022. https://www.oreilly.com/radar/the-world-beyond-batch-streaming-102/. Three more concepts:\nWatermarks: Useful for event time windowing. All input data with event times less than watermark have been observed. Triggers: Signal for a window to produce output. Accumulation: The way to handle multiple results that are observed for the same window. Streaming 101 Redux What: Transformations Where: windowing Make a temporal boundary for a unbounded data source.",
  "keywords": [
    
  ],
  "articleBody": " tags: Bigdata,Flink,Dataflow Model,Streaming source: “Streaming 102: The World beyond Batch – O’Reilly.” Accessed January 5, 2022. https://www.oreilly.com/radar/the-world-beyond-batch-streaming-102/. Three more concepts:\nWatermarks: Useful for event time windowing. All input data with event times less than watermark have been observed. Triggers: Signal for a window to produce output. Accumulation: The way to handle multiple results that are observed for the same window. Streaming 101 Redux What: Transformations Where: windowing Make a temporal boundary for a unbounded data source.\nFixed window Sliding window Session window Streaming 102 When: watermarks Watermarks is a function: \\(F(P) -\u003e E\\)\nP - processing time E - event time, all inputs with event time less than E have been observed. The guarantee of watermarks:\nPerfect watermarks: no late data, all inputs with event time less than watermarks have been observed. Heuristic watermarks: may have late data, as accurate as possible. The data may late if the gap between processing time and event time is too large. When: windows are materialized? The watermark passes the end of the window.\nShortcomings of watermarks:\nToo slow: will be very slow to konwn unprocessed data. Too fast: window may miss data that cause late data. When: triggers Triggers complete watermarks that answered: When in processing time are results materialized?\nTriggers:\nWatermark progress: implicit version that will be trigger when the watermark passed the end of the window. Processing time progress Element counts: Triggering when some finite number of elements have been observed in a window. Punctuations: data-dependent triggers Composite triggers:\nRepetitions Conjunctions (logical AND) Disjunctions (logical OR) Sequences How: accumulation Do refinements of results relate when multiple panes are produced by triggers in a single window.\nThree different modes of accumulation:\nDiscarding Accumulating Accumulatin \u0026 retracting Where: session windows Captures a period of activity, terminated by a gap of inactivity.\nIntermezzo What results are calculated? Answered via transformations. Where in event time are results calculated? Answered via windowing. When in processing time are results materialized? Answered via watermarks and triggers. How do refinements of results relate? Answered via accumulation modes. ",
  "wordCount" : "338",
  "inLanguage": "en",
  "datePublished": "2022-01-05T16:41:00+08:00",
  "dateModified": "2022-01-05T16:41:00+08:00",
  "author":[{
    "@type": "Person",
    "name": "Gray King"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://notes.0081800.xyz/notes/20220105164146-streaming_102_the_world_beyond_batch/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Taking Smart Notes With Org-mode",
    "logo": {
      "@type": "ImageObject",
      "url": "https://notes.0081800.xyz/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://notes.0081800.xyz/" accesskey="h" title="Taking Smart Notes With Org-mode (Alt + H)">Taking Smart Notes With Org-mode</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://notes.0081800.xyz/articles/" title="Articles">
                    <span>Articles</span>
                </a>
            </li>
            <li>
                <a href="https://notes.0081800.xyz/notes/" title="Notes">
                    <span>Notes</span>
                </a>
            </li>
            <li>
                <a href="https://notes.0081800.xyz/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://notes.0081800.xyz/">Home</a>&nbsp;»&nbsp;<a href="https://notes.0081800.xyz/notes/">Notes</a></div>
    <h1 class="post-title">
      Streaming 102: The world beyond batch
    </h1>
    <div class="post-meta"><span title='2022-01-05 16:41:00 +0800 +0800'>January 5, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Gray King

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#streaming-101-redux" aria-label="Streaming 101 Redux">Streaming 101 Redux</a><ul>
                        
                <li>
                    <a href="#what-transformations" aria-label="What: Transformations">What: Transformations</a></li>
                <li>
                    <a href="#where-windowing" aria-label="Where: windowing">Where: windowing</a></li></ul>
                </li>
                <li>
                    <a href="#streaming-102" aria-label="Streaming 102">Streaming 102</a><ul>
                        
                <li>
                    <a href="#when-watermarks" aria-label="When: watermarks">When: watermarks</a></li>
                <li>
                    <a href="#when-triggers" aria-label="When: triggers">When: triggers</a></li>
                <li>
                    <a href="#how-accumulation" aria-label="How: accumulation">How: accumulation</a></li>
                <li>
                    <a href="#where-session-windows" aria-label="Where: session windows">Where: session windows</a></li></ul>
                </li>
                <li>
                    <a href="#intermezzo" aria-label="Intermezzo">Intermezzo</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><ul>
<li>tags: <a href="/topics/20200320100519_%E5%A4%A7%E6%95%B0%E6%8D%AE/">Bigdata</a>,<a href="/projects/20200320100601_flink/">Flink</a>,<a href="/notes/20220105163640-dataflow_model/">Dataflow Model</a>,<a href="/notes/20220105165615-streaming/">Streaming</a></li>
<li>source: “Streaming 102: The World beyond Batch – O’Reilly.” Accessed January 5, 2022. <a href="https://www.oreilly.com/radar/the-world-beyond-batch-streaming-102/">https://www.oreilly.com/radar/the-world-beyond-batch-streaming-102/</a>.</li>
</ul>
<p>Three more concepts:</p>
<ul>
<li><strong>Watermarks</strong>: Useful for event time windowing. All input data with event times less than <em>watermark</em> have been observed.</li>
<li><strong>Triggers</strong>: Signal for a window to produce output.</li>
<li><strong>Accumulation</strong>: The way to handle multiple results that are observed for the same window.</li>
</ul>
<h2 id="streaming-101-redux">Streaming 101 Redux<a hidden class="anchor" aria-hidden="true" href="#streaming-101-redux">#</a></h2>
<h3 id="what-transformations">What: Transformations<a hidden class="anchor" aria-hidden="true" href="#what-transformations">#</a></h3>
<h3 id="where-windowing">Where: windowing<a hidden class="anchor" aria-hidden="true" href="#where-windowing">#</a></h3>
<p>Make a temporal boundary for a unbounded data source.</p>
<ul>
<li>Fixed window</li>
<li>Sliding window</li>
<li>Session window</li>
</ul>
<figure>
    <img loading="lazy" src="/ox-hugo/2022-01-06_11-23-54_Figure-03-Windowing.jpg"/> 
</figure>

<h2 id="streaming-102">Streaming 102<a hidden class="anchor" aria-hidden="true" href="#streaming-102">#</a></h2>
<h3 id="when-watermarks">When: watermarks<a hidden class="anchor" aria-hidden="true" href="#when-watermarks">#</a></h3>
<p>Watermarks is a function:
\(F(P) -&gt; E\)</p>
<ul>
<li><em>P</em> - processing time</li>
<li><em>E</em> - event time, all inputs with event time less than <em>E</em> have been observed.</li>
</ul>
<p>The guarantee of watermarks:</p>
<ul>
<li><strong>Perfect watermarks</strong>: no late data, all inputs with event time less than watermarks have been observed.</li>
<li><strong>Heuristic watermarks</strong>: may have late data, as accurate as possible. The data may late if the gap between processing time and event time is too large.</li>
</ul>
<p><strong>When</strong>: windows are materialized? The watermark passes the end of the window.</p>
<p>Shortcomings of watermarks:</p>
<ul>
<li><strong>Too slow</strong>: will be very slow to konwn unprocessed data.</li>
<li><strong>Too fast</strong>: window may miss data that cause late data.</li>
</ul>
<h3 id="when-triggers">When: triggers<a hidden class="anchor" aria-hidden="true" href="#when-triggers">#</a></h3>
<p>Triggers complete watermarks that answered: <strong>When</strong> in processing time are results materialized?</p>
<p>Triggers:</p>
<ul>
<li><strong>Watermark progress</strong>: implicit version that will be trigger when the watermark passed the end of the window.</li>
<li><strong>Processing time progress</strong></li>
<li><strong>Element counts</strong>: Triggering when some finite number of elements have been observed in a window.</li>
<li><strong>Punctuations</strong>: data-dependent triggers</li>
</ul>
<p>Composite triggers:</p>
<ul>
<li><strong>Repetitions</strong></li>
<li><strong>Conjunctions</strong> (logical AND)</li>
<li><strong>Disjunctions</strong> (logical OR)</li>
<li><strong>Sequences</strong></li>
</ul>
<h3 id="how-accumulation">How: accumulation<a hidden class="anchor" aria-hidden="true" href="#how-accumulation">#</a></h3>
<p>Do refinements of results relate when multiple panes are produced by triggers in a single window.</p>
<p>Three different modes of accumulation:</p>
<ul>
<li><strong>Discarding</strong></li>
<li><strong>Accumulating</strong></li>
<li><strong>Accumulatin &amp; retracting</strong></li>
</ul>
<h3 id="where-session-windows">Where: session windows<a hidden class="anchor" aria-hidden="true" href="#where-session-windows">#</a></h3>
<p>Captures a period of activity, terminated by a gap of inactivity.</p>
<h2 id="intermezzo">Intermezzo<a hidden class="anchor" aria-hidden="true" href="#intermezzo">#</a></h2>
<blockquote>
<ul>
<li><em>What</em> results are calculated? Answered via transformations.</li>
<li><em>Where</em> in event time are results calculated? Answered via windowing.</li>
<li><em>When</em> in processing time are results materialized? Answered via watermarks and triggers.</li>
<li><em>How</em> do refinements of results relate? Answered via accumulation modes.</li>
</ul>
</blockquote>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>


   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   


<hr />

  <div class="bl-section">
    <h4>No notes link to this note</h4>
  </div>


</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://notes.0081800.xyz/">Taking Smart Notes With Org-mode</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
